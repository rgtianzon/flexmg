<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>test EOD</title>
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    <style>
        body {
            background: linear-gradient(to right,#36d1dc,#5b86e5);
            font-family: Poppins;
            text-align: center;
            color: white;
            }
        hr {
            margin-top: 1rem;
            margin-bottom: 1rem;
            border: 0;
            border-top: 2px solid white;
        }
        .container {
            padding: 10px;
            margin-top: 80px;
            background-color: transparent;
            width: 100%;
            border-radius: 10px;
        }
        .item {
            width: 100px;
            padding: 10px;
            display: inline-block;
            vertical-align: middle
        }
        .navbar {
            margin-bottom: 0px;
        }
        .btn-outline-info {
            color: white;
            border: 2px solid white;
            font-weight: bold;
        }
        #npdf {
            margin-bottom: 10px;
           /* border: 2px solid white;*/
            padding: 30px;
            border-radius: 20px;
            background:  rgb(2, 132, 155);
        }

        #pdf {
            margin-bottom: 10px;
           /* border: 2px solid white;*/
            padding: 30px;
            border-radius: 20px;
            background:  rgb(2, 132, 155);
        }
        #btnstart{
            width: 60%;
            border-style: solid;
            margin: 10px;
            border-radius: 10px;
            font-weight: 500;
        }

        #lgo {
            margin-bottom: 0;
        }

        .col-md-4 {
            text-align: center;
        }

        #welcome {
            color: white;
        }

        .item {
            width: auto;
        }
        .table {
            width: 100%;
            margin-bottom: 1rem;
            color: white;
        }
        .table-danger, .table-danger>td, .table-danger>th {
            background-color: transparent;
            border: 2px solid white;
        }
        .table-info, .table-info>td, .table-info>th {
            background-color: transparent;
            border: 2px solid white;
        }
        #oghead {
        background: rgb(2, 132, 155);
        }
        #exampleModalLabel{
            color: darkslategrey;
        }
        .text-white { 
            padding: 10px;
        }
        #campModal {
            color: darkslategrey;
        }
        #statecampaign {
            margin-bottom: 10px;
           /* border: 2px solid white;*/
            padding: 20px;
            border-radius: 20px;
            background:  rgb(2, 132, 155);
        }
        h3{
            font-weight: bold;
        }
        .footer{
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background-color:#343a40;
            color: white;
            float:left;
            text-align: left;
            font-size: 12px;
            padding: 10px;
        }
        p{
            margin: 0;
        }
        #wcrh {
            color: darkslategrey;
        }
        .eodtxt {
            border: 2px solid white;
            border-radius: 20px;
        }
        .eodbtn {
            margin: 20px;
        }
    </style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
	<div class="container">
		<h4>End of Day Report</h4>
		<h4>Outbound Sales Team - Special Projects</h4>
		<div class="row">
			<div class="col-md-4"></div>
			<div class="col-md-4" id="date"></div>
			<div class="col-md-4"></div>
		</div>
		<hr>
		<div class="row">
			<div class="col align-self-center">
				<p>Overall</p>
				<table class="table">
					<tr class="table-danger">
						<th scope="col">Prospected Leads</th>
						<th scope="col">Good Leads</th>
						<th scope="col">Website</th>
						<th scope="col">Email</th>
						<th scope="col">LinkedIn</th>
						<th scope="col">FB</th>
						<th scope="col">Skype</th>
					</tr>
					<tr class="table-danger">
						<td id="pl"></td>
						<td id="gl"></td>
						<td id="ws"></td>
						<td id="em"></td>
						<td id="li"></td>
						<td id="fb"></td>
						<td id="sk"></td>
					</tr>
				</table>
			</div>
		</div>
		<hr>
		<div class="row">
			<div class="col align-self-center">
				<p>Prospectors</p>
				<table class="table" id="prs">
					<tr class="table-danger">
						<th scope="col">Prospector</th>
						<th scope="col">Prospected Leads</th>
						<th scope="col">Good Leads</th>
						<th scope="col">Website</th>
						<th scope="col">Email</th>
						<th scope="col">LinkedIn</th>
						<th scope="col">FB</th>
						<th scope="col">Skype</th>
					</tr>
				</table>
			</div>
		</div>
		<hr>
		<div class="row">
			<div class="col align-self-center">
				<p>Campaigns</p>
				<table class="table" id="camps">
					<tr class="table-danger">
						<th scope="col">Campaign</th>
						<th scope="col">Prospected Leads</th>
						<th scope="col">Good Leads</th>
						<th scope="col">Website</th>
						<th scope="col">Email</th>
						<th scope="col">LinkedIn</th>
						<th scope="col">FB</th>
						<th scope="col">Skype</th>
					</tr>
				</table>
			</div>
        </div>
        <div class="row">
            <div class="col-md-3 eodtxt">
                <h5>Remarks</h5>
                <p id="rmk"></p>
            </div>
            <div class="col-md-3 eodtxt">
                <h5>Challenges</h5>
                <p id="chs"></p>
            </div>
            <div class="col-md-3 eodtxt">
                <h5>Action Items</h5>
                <p id="ati"></p>
            </div>
            <div class="col-md-3 eodtxt">
                <h5>Updates</h5>
                <p id="upd"></p>
            </div>
        </div>
	</div>
<script>

	fetch('https://flexmg.herokuapp.com/api')
		.then((res)=>{
			return res.json()
		})
		.then((data)=>{
			let doneCamp = data.filter((camp)=>{
				return camp.onGoing == false
			})

			function convertTZ(date, tzString) {
    			return new Date((typeof date === "string" ? new Date(date) : date).toLocaleString("en-US", {timeZone: tzString}));
			}

			let nytime = convertTZ(new Date(), "America/New_York")
			// overall table
			const dceod = [];
			for(i=0;i<doneCamp.length;i++){
				if (new Date(doneCamp[i].created_at).toISOString().replace(/T/, ' ').split(' ')[0] === `${nytime.getFullYear()}-${nytime.getMonth()+1}-${nytime.getDate()}`) {
					dceod.push(doneCamp[i])
				}
			}

			// console.log(dceod)
			let eodarray = [];
			let eoddate = [];

			$.each(dceod, function () {
			// Easiest way to get your required date format
   			let date = new Date(this.created_at).toISOString().replace(/T/, ' ').split(' ')[0];
   			// console.log(date)
   			let index = eoddate.indexOf(date);
   			if (index == -1) {
       			eoddate.push(date);
       			let obj = {Date: date, leadsProspected: this.leadsProspected, goodLeads: this.goodLeads, website: this.website, email: this.email, linkedin: this.linkedin, fb: this.fb, Skype: this.Skype};
       			eodarray.push(obj);
   			} 
   			else {
       			eodarray[index].leadsProspected += this.leadsProspected;
       			eodarray[index].goodLeads += this.goodLeads;
       			eodarray[index].website += this.website;
       			eodarray[index].email += this.email;
       			eodarray[index].linkedin += this.linkedin;
       			eodarray[index].fb += this.fb;
       			eodarray[index].Skype += this.Skype;
   				}
			});

			document.querySelector('#date').innerText = `Date: ${eodarray[eodarray.length-1].Date}`;

			document.querySelector('#pl').innerText = `${eodarray[eodarray.length-1].leadsProspected}`;
			document.querySelector('#gl').innerText = `${eodarray[eodarray.length-1].goodLeads}`;
			document.querySelector('#ws').innerText = `${eodarray[eodarray.length-1].website}`;
			document.querySelector('#em').innerText = `${eodarray[eodarray.length-1].email}`;
			document.querySelector('#li').innerText = `${eodarray[eodarray.length-1].linkedin}`;
			document.querySelector('#fb').innerText = `${eodarray[eodarray.length-1].fb}`;
			document.querySelector('#sk').innerText = `${eodarray[eodarray.length-1].Skype}`;

			// -----------------------------------------------------------



			let uname = []
			for(i=0;i<dceod.length;i++){
				if (i===0){
					uname.push(dceod[i].fullName)
				} else if(dceod[i].fullName !== dceod[i-1].fullName) {
					uname.push(dceod[i].fullName)
				}
			}

			let tbl = document.querySelector('#prs')

			for(i=0;i<uname.length;i++){
				let fneod = [];
				for(o=0;o<dceod.length;o++){
					fneod = dceod.filter((fleod)=>{
						return uname[i] == fleod.fullName
					})
				}
				let sumleadsProspected = 0
				let sumgoodLeads = 0
				let sumwebsite = 0
				let sumemail = 0
				let sumlinkedin = 0
				let sumfb = 0
				let sumSkype = 0
				for(p=0;p<fneod.length;p++){
					sumleadsProspected = sumleadsProspected + fneod[p].leadsProspected
					sumgoodLeads = sumgoodLeads + fneod[p].goodLeads
					sumwebsite = sumwebsite + fneod[p].website
					sumemail = sumemail + fneod[p].email
					sumlinkedin = sumlinkedin + fneod[p].linkedin
					sumfb = sumfb + fneod[p].fb
					sumSkype = sumSkype + fneod[p].Skype
				}
				let tr = document.createElement('TR')
				let td = document.createElement('TD')
				td.innerText=uname[i]
				tbl.appendChild(tr)
				tr.appendChild(td)

				let pltd = document.createElement('TD')
				pltd.innerText = sumleadsProspected
				tr.appendChild(pltd)

				let gltd = document.createElement('TD')
				gltd.innerText = sumgoodLeads
				tr.appendChild(gltd)

				let wtd = document.createElement('TD')
				wtd.innerText = sumwebsite
				tr.appendChild(wtd)

				let emtd = document.createElement('TD')
				emtd.innerText = sumemail
				tr.appendChild(emtd)

				let litd = document.createElement('TD')
				litd.innerText = sumlinkedin
				tr.appendChild(litd)

				let fbtd = document.createElement('TD')
				fbtd.innerText = sumfb
				tr.appendChild(fbtd)

				let sktd = document.createElement('TD')
				sktd.innerText = sumSkype
				tr.appendChild(sktd)
			}

		})
	
	//campaign names
	fetch('http://flexmg.herokuapp.com/campeod/api')
		.then((res) => {
			return res.json()
		})
		.then((data) => {
			let doneCamp = data.filter((camp)=>{
				return camp.onGoing == false
			})
			function convertTZ(date, tzString) {
    			return new Date((typeof date === "string" ? new Date(date) : date).toLocaleString("en-US", {timeZone: tzString}));
			}

			let nytime = convertTZ(new Date(), "America/New_York")
			// overall table
			const cpeod = [];

			let camptbl = document.querySelector('#camps')

			for(i=0;i<doneCamp.length;i++){
				if (new Date(doneCamp[i].created_at).toISOString().replace(/T/, ' ').split(' ')[0] === `${nytime.getFullYear()}-${nytime.getMonth()+1}-${nytime.getDate()}`) {
					cpeod.push(doneCamp[i])
				}
			}

			let campnames = []
			for(i=0;i<cpeod.length;i++){
				if (i===0){
					campnames.push(cpeod[i].CampName)
				} else if(cpeod[i].CampName !== cpeod[i-1].CampName) {
					campnames.push(cpeod[i].CampName)
				}
			}
			// console.log(campnames)

			for(q=0;q<campnames.length;q++){
				let cmpeod = [];
				for(w=0;w<cpeod.length;w++){
					cmpeod = cpeod.filter((cpleod) => {
						return campnames[q] == cpleod.CampName
					})
				}
				let sumleadsProspected = 0
				let sumgoodLeads = 0
				let sumwebsite = 0
				let sumemail = 0
				let sumlinkedin = 0
				let sumfb = 0
				let sumSkype = 0
				for(e=0;e<cmpeod.length;e++){
					sumleadsProspected = sumleadsProspected + cmpeod[e].leadsProspected
					sumgoodLeads = sumgoodLeads + cmpeod[e].goodLeads
					sumwebsite = sumwebsite + cmpeod[e].website
					sumemail = sumemail + cmpeod[e].email
					sumlinkedin = sumlinkedin + cmpeod[e].linkedin
					sumfb = sumfb + cmpeod[e].fb
					sumSkype = sumSkype + cmpeod[e].Skype
				}
				let tr = document.createElement('TR')
				let td = document.createElement('TD')
				td.innerText=campnames[q]
				camptbl.appendChild(tr)
				tr.appendChild(td)

				let pltd = document.createElement('TD')
				pltd.innerText = sumleadsProspected
				tr.appendChild(pltd)

				let gltd = document.createElement('TD')
				gltd.innerText = sumgoodLeads
				tr.appendChild(gltd)

				let wtd = document.createElement('TD')
				wtd.innerText = sumwebsite
				tr.appendChild(wtd)

				let emtd = document.createElement('TD')
				emtd.innerText = sumemail
				tr.appendChild(emtd)

				let litd = document.createElement('TD')
				litd.innerText = sumlinkedin
				tr.appendChild(litd)

				let fbtd = document.createElement('TD')
				fbtd.innerText = sumfb
				tr.appendChild(fbtd)

				let sktd = document.createElement('TD')
				sktd.innerText = sumSkype
				tr.appendChild(sktd)
			}
		})

		fetch('https://flexmg.herokuapp.com/allcampeod/api')
			.then((res)=>{
				return res.json()
			})
			.then((data)=>{

				function convertTZ(date, tzString) {
    				return new Date((typeof date === "string" ? new Date(date) : date).toLocaleString("en-US", {timeZone: tzString}));
				}
				let nytime = convertTZ(new Date(), "America/New_York")
				const allcampeod = [];

				for(i=0;i<data.length;i++){
					if (`${convertTZ(new Date(data[i].eodDate), "America/New_York").getFullYear()}-${convertTZ(new Date(data[i].eodDate), "America/New_York").getMonth()+1}-${convertTZ(new Date(data[i].eodDate), "America/New_York").getDate()}` === `${nytime.getFullYear()}-${nytime.getMonth()+1}-${nytime.getDate()}`) {
						allcampeod.push(data[i])
					}
				}
				let remarks = allcampeod[0].remarks
				let challenges = allcampeod[0].challenges
				let actionItems = allcampeod[0].actionItems
				let updates = allcampeod[0].updates

				document.querySelector('#rmk').innerText = remarks
				document.querySelector('#chs').innerText = challenges
				document.querySelector('#ati').innerText = actionItems
				document.querySelector('#upd').innerText = updates
			})
</script>

</body>
</html>